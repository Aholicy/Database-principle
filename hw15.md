20337263俞泽斌

15.1

首先定义一下所有需要排序的数据

按照在题目中出现的顺序依次设为a1~a12

step1 首先全部分成最大为三个的组合并排好序   

​			s11={a3,a1,a2}

​			s12={a6,a5,a4}

​			s13={a9,a7,a8}

​			s14={a12,a11,a10}

step2 因为每一次memory可以进3个，所以将前三个进行

​			s21={a3,a1,a6,a9,a5,a2,a7,a4,a8}

​			s22={a12,a11,a10}

step3 s31={a12,a3,a11,a10,a1,a6,a9,a5,a2,a7,a4,a8}

15.3

a、Nested-loop join:
$$
Br1=tr1 /25 =20000 /25=800
$$

$$
Br2=tr2 /30 =45000 /30=1500
$$

如果内存能装入800个块，及M>=800,此时只需要2300次磁盘访问

当M<800时

r1为外层循环嵌套：磁盘访问 20000*1500+800=30000800次

r2为外层循环嵌套：磁盘访问 45000*800 +1500=36001500次

b、Block nested-loop join:

如果内存能装入800个块，及M>=800,此时只需要2300次磁盘访问, 加上2次磁盘搜索

当M<800时

r1为外层循环嵌套：磁盘访问  
$$
\frac{800}{M-2}*1500 +800次
$$
磁盘搜索
$$
\frac{800}{M-2}*2次
$$
r2为外层循环嵌套：磁盘访问 
$$
\frac{1500}{M-2}*800 +1500次
$$
磁盘搜索
$$
\frac{1500}{M-2}*2次
$$


c、Merge-join

设 bb=1

首先是已经排好序的情况，那么只需要1500+800=2300次磁盘访问

同时需要2300次磁盘搜索

如果没有排好序
$$
Bs=1500*(2[log_{(M-1)}(1500/M)]+2)+800*(2[log_{(M-1)}(800/M)]+2)
$$
磁盘访问数为
$$
1500*(2[log_{(M-1)}(1500/M)]+2)+800*(2[log_{(M-1)}(800/M)]+2)+2300次
$$


磁盘搜索数为
$$
2*（1500/M)+1500 *(2 *log_{M-1}(1500/M)-1)+2*（800/M)+800 *(2 *log_{M-1}(800/M)-1)次
$$


d、hash-join

r1为 build relation

r2为 probe relation

假设没有溢出，如果不需要递归划分，即M>800

需要3*（1500+800）=6900 次块传输

需要 2*800+1500=3100次磁盘搜索

如果需要递归划分，则块传输次数为
$$
2*(1500+800)*[log_{(M-1)}(800)]-1)+2300次块传输
$$
磁盘搜索次数
$$
2(800+1500)[log_{M-1}(1500)-1]次
$$
